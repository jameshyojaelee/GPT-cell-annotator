---
title: "Annotate Seurat Objects with GPT Cell Annotator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Annotate Seurat Objects with GPT Cell Annotator}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

`gptcellannotator` is CLI-first. It shells out to `gca annotate` and parses the
validated JSON report. Live LLM calls are opt-in via `OPENAI_API_KEY`.

## Configure the CLI

```{r}
library(gptcellannotator)

cfg <- gptca_config(offline = TRUE, cli_path = Sys.which("gca"))
gptca_config_set(cfg)
```

## Annotate Seurat markers

```{r, eval=FALSE}
library(Seurat)

pbmc <- readRDS("pbmc_seurat.rds")
markers <- FindAllMarkers(pbmc, min.pct = 0.25, logfc.threshold = 0.25)

annotations <- gptca_annotate_seurat(
  pbmc,
  markers = markers,
  species = "Homo sapiens",
  return_validated = TRUE
)

pbmc <- gptca_add_metadata(pbmc, annotations)
```

## Inspect results

```{r, eval=FALSE}
annotations$clusters
```

## Troubleshooting

- Ensure `gca` is on `PATH` or set `GPTCA_CLI_PATH`.
- Set `OPENAI_API_KEY` and `offline = FALSE` if you want live LLM calls.
